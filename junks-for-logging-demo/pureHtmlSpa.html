<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Advanced Pure SPA</title>
    <style>
      /* --- CSS Variables & Dark Mode --- */
      :root {
        --primary: #6366f1;
        --bg: #f8fafc;
        --card-bg: #ffffff;
        --text: #1e293b;
        --text-muted: #64748b;
        --border: #e2e8f0;
        --nav-bg: rgba(255, 255, 255, 0.9);
      }

      /* Dark Theme Class */
      body.dark-mode {
        --primary: #818cf8;
        --bg: #0f172a;
        --card-bg: #1e293b;
        --text: #f1f5f9;
        --text-muted: #94a3b8;
        --border: #334155;
        --nav-bg: rgba(30, 41, 59, 0.9);
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        font-family: "Segoe UI", sans-serif;
        background-color: var(--bg);
        color: var(--text);
        transition: background 0.3s, color 0.3s;
        padding-bottom: 50px;
      }

      /* --- Navigation --- */
      header {
        position: sticky;
        top: 0;
        background: var(--nav-bg);
        backdrop-filter: blur(10px);
        border-bottom: 1px solid var(--border);
        z-index: 100;
      }

      nav {
        max-width: 900px;
        margin: 0 auto;
        padding: 1rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .logo {
        font-weight: 800;
        font-size: 1.25rem;
        color: var(--primary);
        text-decoration: none;
      }

      .nav-links {
        display: flex;
        gap: 20px;
        align-items: center;
      }

      .nav-links a {
        text-decoration: none;
        color: var(--text-muted);
        font-weight: 600;
        transition: color 0.2s;
      }

      .nav-links a:hover,
      .nav-links a.active {
        color: var(--primary);
      }

      /* Theme Toggle Button */
      .theme-btn {
        background: none;
        border: 1px solid var(--border);
        color: var(--text);
        padding: 5px 10px;
        border-radius: 20px;
        cursor: pointer;
        font-size: 0.8rem;
      }

      /* --- Layout & Grid --- */
      main {
        max-width: 900px;
        margin: 2rem auto;
        padding: 0 1rem;
      }

      .grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 1.5rem;
      }

      /* --- Cards --- */
      .card {
        background: var(--card-bg);
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 1.5rem;
        transition: transform 0.2s;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
      }

      .card:hover {
        transform: translateY(-2px);
        border-color: var(--primary);
      }

      h2 {
        font-size: 1.1rem;
        margin-bottom: 0.5rem;
      }
      p {
        color: var(--text-muted);
        font-size: 0.9rem;
        margin-bottom: 1rem;
      }

      /* --- Buttons --- */
      .btn {
        background-color: var(--primary);
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 0.9rem;
        align-self: flex-start;
      }
      .btn.outline {
        background: transparent;
        border: 1px solid var(--primary);
        color: var(--primary);
      }
      .btn:active {
        transform: scale(0.98);
      }

      /* --- Loading Spinner --- */
      .spinner {
        border: 4px solid var(--border);
        border-top: 4px solid var(--primary);
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
        margin: 50px auto;
      }
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
    </style>
  </head>
  <body>
    <header>
      <nav>
        <a href="#home" class="logo">PureSPA Pro</a>
        <div class="nav-links">
          <a href="#home" data-link>Home</a>
          <a href="#posts" data-link>Posts (API)</a>
          <a href="#saved" data-link>Saved (<span id="saved-count">0</span>)</a>
          <button class="theme-btn" onclick="toggleTheme()">ðŸŒ“ Theme</button>
        </div>
      </nav>
    </header>

    <main id="app"></main>

    <script>
      // --- 1. STATE MANAGEMENT ---
      const state = {
        posts: [], // Will store data fetched from API
        savedIds: new Set(), // Will store IDs of favorites
        hasFetched: false,
      };

      // --- 2. HELPERS ---

      // Dark Mode Logic
      function initTheme() {
        const savedTheme = localStorage.getItem("theme");
        if (savedTheme === "dark") document.body.classList.add("dark-mode");
      }

      function toggleTheme() {
        document.body.classList.toggle("dark-mode");
        const isDark = document.body.classList.contains("dark-mode");
        localStorage.setItem("theme", isDark ? "dark" : "light");
      }

      // --- 3. VIEW FUNCTIONS (Components) ---
      // Instead of static strings, we use functions that return HTML strings.

      const Views = {
        home: async () => `
                <div style="text-align:center; padding: 40px 20px;">
                    <h1 style="font-size: 2.5rem; margin-bottom: 1rem; color: var(--primary);">Pure JS Features</h1>
                    <p style="font-size: 1.1rem; max-width: 600px; margin: 0 auto 30px;">
                        This example demonstrates <strong>Async Data Fetching</strong>, 
                        <strong>Global State Management</strong>, and <strong>Theme Toggling</strong> 
                        without a single library.
                    </p>
                    <a href="#posts" class="btn" style="text-decoration:none; font-size: 1.1rem;">Browse Posts via API &rarr;</a>
                </div>
            `,

        posts: async () => {
          // If we haven't fetched data yet, fetch it now.
          if (!state.hasFetched) {
            try {
              const res = await fetch(
                "https://jsonplaceholder.typicode.com/posts?_limit=12"
              );
              state.posts = await res.json();
              state.hasFetched = true;
            } catch (e) {
              return `<p>Error loading posts.</p>`;
            }
          }

          // Generate HTML for the grid
          const postsHtml = state.posts
            .map((post) => {
              const isSaved = state.savedIds.has(post.id);
              return `
                    <div class="card">
                        <div>
                            <h2>${post.title.substring(0, 30)}...</h2>
                            <p>${post.body.substring(0, 100)}...</p>
                        </div>
                        <button 
                            class="btn ${isSaved ? "outline" : ""}" 
                            onclick="toggleSave(${post.id})">
                            ${isSaved ? "Remove Saved" : "â™¥ Save Post"}
                        </button>
                    </div>`;
            })
            .join("");

          return `
                    <div style="margin-bottom: 20px;">
                        <h1>Latest Posts</h1>
                        <p>Fetched from JSONPlaceholder API.</p>
                    </div>
                    <div class="grid">${postsHtml}</div>
                `;
        },

        saved: async () => {
          // Filter the global posts array by saved IDs
          const savedPosts = state.posts.filter((p) =>
            state.savedIds.has(p.id)
          );

          if (savedPosts.length === 0) {
            return `
                        <div style="text-align: center; margin-top: 50px;">
                            <h2>No saved items yet.</h2>
                            <p>Go to the <a href="#posts" style="color:var(--primary)">Posts</a> page to add some!</p>
                        </div>
                    `;
          }

          const html = savedPosts
            .map(
              (post) => `
                    <div class="card">
                        <h2>${post.title}</h2>
                        <button class="btn outline" onclick="toggleSave(${post.id})">Remove</button>
                    </div>
                `
            )
            .join("");

          return `
                    <h1>Your Saved Collection</h1>
                    <div class="grid" style="margin-top:20px;">${html}</div>
                `;
        },
      };

      // --- 4. ACTIONS (Event Handlers) ---

      // We attach this to window so the HTML onclick="" strings can find it
      window.toggleSave = function (id) {
        if (state.savedIds.has(id)) {
          state.savedIds.delete(id);
        } else {
          state.savedIds.add(id);
        }
        updateSavedCount();
        router(); // Re-render current page to update button styles
      };

      function updateSavedCount() {
        document.getElementById("saved-count").innerText = state.savedIds.size;
      }

      // --- 5. ROUTER ---

      async function router() {
        const app = document.getElementById("app");
        let hash = window.location.hash.slice(1) || "home";

        // Highlight Nav
        document.querySelectorAll(".nav-links a").forEach((el) => {
          el.classList.toggle("active", el.getAttribute("href") === `#${hash}`);
        });

        // 1. Show Loading Spinner (if async takes time)
        if (hash === "posts" && !state.hasFetched) {
          app.innerHTML = '<div class="spinner"></div>';
        }

        // 2. Get View Function
        const viewFn = Views[hash] || Views["home"];

        // 3. Render
        app.innerHTML = await viewFn();
      }

      // --- 6. INIT ---
      window.addEventListener("hashchange", router);
      window.addEventListener("load", () => {
        initTheme();
        router();
      });
    </script>
  </body>
</html>
